function p({livewireKey:o,isDraggable:l=!0}){return{livewireKey:o,isDraggable:l,isDragOver:!1,isDragging:!1,onDragStart(t){this.isDragging=!0;let i=this.$el;t.dataTransfer.setData("draggable-id",i.getAttribute("data-draggable-id")),t.dataTransfer.effectAllowed="move"},onDragEnd(t){this.isDragging=!1},onDragOver(t){t.preventDefault(),this.isDragOver=!0,t.dataTransfer.dropEffect="move"},onDragLeave(t){t.currentTarget.contains(t.relatedTarget)||(this.isDragOver=!1)},onDrop(t){let i=t.dataTransfer.getData("draggable-id"),a=this.$el.getAttribute("data-draggable-id");t.preventDefault(),this.isDragOver=!1;try{i!==a?Livewire.dispatch("moveMediaItem",{livewireKey:this.livewireKey,targetId:i,toId:a}):console.warn("Cannot move item to itself:",{sourceId:i,targetId:a})}catch(h){console.error("Error parsing dragged item:",h)}}}}function v({baseUrl:o,mediaId:l,refreshLivewireEvents:t=[],refreshWindowEvents:i=[],refreshDocumentEvents:a=[],refreshKeysTracker:h=[],cacheBuster:d=!0,retryAttempts:c=3,retryDelay:u=1e3,fallbackSrc:f=null,onUpdate:g=null,onError:m=null,defaultLoadingState:y=!1}){return{src:null,baseUrl:o,mediaId:l,refreshTracker:{events:{livewire:t,window:i,document:a},monitoredKeys:h},cacheBuster:d,isLoading:y,hasError:!1,retryCount:0,retryAttempts:c,retryDelay:u,fallbackSrc:f,onUpdate:g,onError:m,generateSrc(){let e=null;try{if(this.$el&&this.$el.getAttribute&&(e=this.$el.getAttribute("data-base-url")),!e){let s=this.$el&&this.$el.querySelector?this.$el.querySelector("img[data-base-url]"):null;s&&(e=s.getAttribute("data-base-url"))}}catch{}let r=e||this.baseUrl;if(!r)return null;let n=r;if(this.cacheBuster){let s=n.includes("?")?"&":"?";n+=`${s}t=${Date.now()}`}return n},updateSrc(){this.isLoading=!0;let e=this.generateSrc();e!==this.src&&(this.src=e,this.hasError=!1,this.retryCount=0,this.onUpdate&&typeof this.onUpdate=="function"&&this.onUpdate(e,this.mediaId));try{if(this.$el)if(this.$el.tagName&&this.$el.tagName.toLowerCase()==="img")this.$el.src=e;else{let r=this.$el.querySelector?this.$el.querySelector("img"):null;r&&(r.src=e)}}catch{}this.isLoading=!1},handleImageError(){console.warn(`Image load error for media ${this.mediaId}, attempt ${this.retryCount+1}/${this.retryAttempts}`),this.retryCount<this.retryAttempts?(this.retryCount++,setTimeout(()=>{this.updateSrc()},this.retryDelay*this.retryCount)):(this.hasError=!0,this.fallbackSrc&&(this.src=this.fallbackSrc),this.onError&&typeof this.onError=="function"&&this.onError(this.mediaId,this.retryCount),console.error(`Failed to load image for media ${this.mediaId} after ${this.retryAttempts} attempts`))},handleImageLoad(){this.isLoading=!1,this.hasError=!1,this.retryCount=0},init(){this.updateSrc(),window.Livewire&&this.refreshTracker.events.livewire.forEach(e=>{this.$wire.on(e,r=>{this.updateSrc()})}),this.refreshTracker.events.window.forEach(e=>{window.addEventListener(`${e}`,r=>{this.updateSrc()})}),this.refreshTracker.events.document.forEach(e=>{document.addEventListener(`${e}`,r=>{this.shouldRefreshForEvent(e,r.detail)&&this.updateSrc()})}),this.refreshTracker.monitoredKeys.forEach(e=>{this.$watch(e,(r,n)=>{this.updateSrc()})})},refresh(){this.updateSrc()},retry(){this.hasError=!1,this.retryCount=0,this.updateSrc()}}}document.addEventListener("alpine:init",()=>{Alpine.data("mediaItem",p),Alpine.data("dynamicImage",v)});
